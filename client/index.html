<!DOCTYPE html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Phaser - Template</title>
    <link rel="stylesheet" href="https://unpkg.com/xterm@4.18.0/css/xterm.css"/>
    <!-- <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script> -->
    <script src="https://cdn.html.games.alexa.a2z.com/alexa-html/latest/alexa-html.js"></script>
    <script src="https://unpkg.com/colyseus.js@^0.14.13/dist/colyseus.js"></script>
    <script src="https://unpkg.com/xterm@4.18.0/lib/xterm.js"></script>

  </head>
  <body>
    <!-- <script type= "module" src="scripts/game.js"></script>
    <img id="qr" onclick="toggleQR();"></img> -->
    <div id = "terminal"></div>
    <script>
         var term = new Terminal({
                fontFamily: "Hack"
            });
            term.open(document.getElementById("terminal"));

            const PROTOCOL = window.location.protocol.replace("http", "ws");
            const ENDPOINT = (window.location.hostname.indexOf("heroku") >= 0 || window.location.hostname.indexOf("now.sh") >= 0 )
            ? `${ PROTOCOL }//${ window.location.hostname }` // port 80 on heroku or now
            : `${ PROTOCOL }//${ window.location.hostname }:8080` // port 8080 on localhost



            
            const roomname = 'gameRoom';

            term.writeln(`connecting to ${ENDPOINT}`);
            var client = new Colyseus.Client(ENDPOINT);

            term.writeln(`joining ${roomname}`);

            client.joinOrCreate(roomname).then(room=> {
                term.writeln('ghosts$');

                room.onMessage("message", (message)=> {
                    term.write(message);
                });
                
                term.setOption('cursorBlink',true);
                term.onData((data) => {
                    room.send('message', data);
                })

            });

    </script>
  </body>
</html>
